# 🎮 暗黑破坏神2：重置版 - Pindleskin自动刷怪程序

> **警告**: 使用自动化程序可能违反游戏服务条款，存在封号风险！建议仅在单机模式使用。

## 📋 目录

- [功能特性](#功能特性)
- [快速开始](#快速开始)
- [配置说明](#配置说明)
- [使用指南](#使用指南)
- [常见问题](#常见问题)

---

## ✨ 功能特性

### 核心功能
- ✅ 全自动刷Pindleskin（从创建游戏到拾取物品）
- ✅ 智能物品检测（基于颜色识别暗金/符文/绿装）
- ✅ 符文等级过滤（可设置只拾取高级符文）
- ✅ 防卡住导航系统（多次重试传送）
- ✅ 安全机制（自动传送离开避免尸爆）

### 防检测功能
- 🎭 时间延迟随机化（±20%变化）
- 🎭 鼠标点击随机偏移（±8像素）
- 🎭 游戏名称自动轮换（5个名称循环）
- 🎭 传送路径随机化

### 统计功能
- 📊 实时效率统计（每小时次数、成功率）
- 📊 物品掉落统计（暗金、符文计数）
- 📊 自动生成报告（每5分钟）
- 📊 保存详细日志

---

## 🚀 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 配置坐标

运行坐标获取工具：
```bash
python coordinate_helper.py
```

按数字键记录以下9个位置：
1. 大厅 - "创建游戏"按钮
2. 大厅 - 游戏名称输入框
3. 大厅 - 密码输入框
4. 大厅 - "开始游戏"按钮
5. 哈洛加斯 - 红门位置
6. Pindle神殿 - Pindle刷新位置
7-9. 传送路径（3个点）

按S保存，然后复制坐标到`config.json`

### 3. 游戏内设置

**技能快捷键**：
- F1: 暴风雪（主攻击技能）
- F2: 静态力场
- 右键: 传送
- 1: 生命药水
- 2: 法力药水

### 4. 运行程序

```bash
python main.py
```

---

## ⚙️ 配置说明

### 基础配置

```json
{
  "bot": {
    "runs_count": 500,              // 总刷怪次数
    "delay_between_runs": 1.2,      // 两局间隔（秒）
    "randomize_delays": true         // 启用随机化
  }
}
```

### 符文过滤

**拾取所有符文**（推荐）：
```json
{
  "pickup": {
    "filter": {
      "pickup_all_runes": true
    }
  }
}
```

**只拾取高级符文**：
```json
{
  "pickup": {
    "filter": {
      "pickup_all_runes": false,
      "min_rune_level": "Mal"  // Mal及以上
    }
  }
}
```

符文等级：`El(1) ~ Zod(33)`，推荐起点：`Io(16)`, `Mal(23)`, `Ist(24)`

### 暗金装备

⚠️ **重要限制**：未鉴定的暗金装备无法识别名称，只能全部拾取或全部跳过。

```json
{
  "pickup": {
    "item_types": ["unique", "rune"],  // 拾取暗金和符文
    "filter": {
      "pickup_all_uniques": true       // 拾取所有暗金
    }
  }
}
```

### 游戏名称轮换

```json
{
  "game_name_rotation": {
    "enabled": true,
    "mode": "sequential",              // 顺序轮换
    "names": ["pindle1", "pindle2", "pindle3"],
    "change_every": 10                 // 每10局换一次
  }
}
```

### 安全设置

```json
{
  "sorceress": {
    "safety": {
      "teleport_away_after_cast": true,     // 施法后传送离开
      "safe_distance_x": 100,               // 安全距离
      "drink_potion_after_kill": true,      // 自动喝药
      "wait_before_pickup": 1.5             // 等待尸爆完成
    }
  }
}
```

---

## 📖 使用指南

### 冰系法师（暴风雪）

#### 战斗流程
```
1. 创建游戏 (2秒)
2. 传送到红门 (3个点，0.9秒)
3. 进入红门 (1.5秒)
4. 传送到Pindle (3个点，0.9秒)
5. 静态力场 x3 (0.75秒)
6. 暴风雪 x3 (3秒)
7. 传送到安全位置 (0.3秒)
8. 等待1.5秒 + 自动喝药
9. 智能拾取物品 (1秒)
10. 离开游戏 (3秒)
```

**总耗时**: 14-18秒/局  
**效率**: 每小时200-260次  
**死亡率**: <1%

#### FCR延迟调整

根据你的FCR（Faster Cast Rate）调整：

```json
{
  "sorceress": {
    "teleport_delay": 0.15,  // FCR 63-105%
    "cast_delay": 0.25
  }
}
```

| FCR | teleport_delay | cast_delay |
|-----|----------------|------------|
| 105%+ | 0.12 | 0.20 |
| 63-105% | 0.15 | 0.25 |
| <63% | 0.18 | 0.30 |

---

## 🛡️ 重要说明

### 1. Pindleskin死亡机制

⚠️ **Pindleskin死亡时会尸爆！**

程序已实现安全机制：
- ✅ 施放完暴风雪后立即传送离开（100像素外）
- ✅ 等待1.5秒确保尸爆完成
- ✅ 自动喝血药预防性补血

### 2. 物品拾取限制

**核心限制**：
- ❌ 暗金装备掉落时是**未鉴定**状态
- ❌ 未鉴定装备无法看到真实名称
- ❌ 程序无法判断未鉴定暗金的价值
- ✅ **只能过滤符文**（符文显示真实名称）

**实际策略**：
- 拾取所有暗金 → 回城鉴定 → 手动筛选
- 只拾取符文 → 放弃所有暗金

### 3. 角色要求

- **职业**: 法师（推荐冰系暴风雪）
- **等级**: 85+
- **生命值**: 1500+ HP（推荐1800+）
- **抗性**: 火抗75%（抵抗尸爆）、物理抗越高越好
- **必需技能**: 传送、暴风雪、静态力场
- **任务**: 必须完成第五章安亚救援（解锁红门）

---

## 🐛 常见问题

### Q1: 找不到游戏窗口
**A**: 
- 确认游戏窗口标题为 "Diablo II: Resurrected"
- 以管理员权限运行脚本
- 检查`config.json`中的`window_title`设置

### Q2: 传送位置不准确/角色卡住
**A**:
- 重新运行`coordinate_helper.py`获取准确坐标
- 增加`town_to_portal_path`的路径点（3个→5个）
- 调整`teleport_delay`（增加到0.20-0.25秒）

### Q3: 检测不到物品
**A**:
- 运行`calibrate_colors.py`校准颜色
- 调整`scan_area`扩大扫描范围
- 确认物品掉落在扫描区域内

### Q4: 角色被炸死
**A**:
- 提升角色生命值到1800+
- 火焰抗性达到75%上限
- 增加安全距离：
  ```json
  {
    "safe_distance_x": 150,
    "safe_distance_y": -100,
    "wait_before_pickup": 2.0
  }
  ```

### Q5: 如何只拾取高级符文？
**A**:
```json
{
  "pickup": {
    "item_types": ["rune"],  // 只拾取符文
    "filter": {
      "pickup_all_runes": false,
      "min_rune_level": "Ist"  // 只要Ist及以上
    }
  }
}
```

---

## 📊 统计报告

程序会自动生成统计报告：

```
╔══════════════════════════════════════════╗
║          📊 刷怪统计报告                  ║
╠══════════════════════════════════════════╣
║ 运行时长: 02:30:15
║ 总次数:   350
║ 成功:     348
║ 失败:     2
║ 成功率:   99.4%
║ 
║ 效率指标:
║ - 平均单局时间: 15.80 秒
║ - 每小时次数:   230.2
║ 
║ 拾取物品:
║ - 💎 暗金: 45
║ - 🔮 符文: 28
║ - 🌟 绿装: 12
║ - ⚡ 亮黄: 8
╚══════════════════════════════════════════╝
```

统计会保存到`run_statistics.txt`文件。

---

## 🎯 最佳实践

### 降低风险
1. ✅ 启用随机化功能（已默认）
2. ✅ 游戏名称自动轮换（已配置）
3. ✅ 分批运行（每次50-100局）
4. ✅ 定期休息（每小时休息10-15分钟）
5. ✅ 避免24/7连续运行

### 提升效率
1. 根据FCR调整延迟时间
2. 优化传送路径坐标
3. 关闭不必要的图形特效
4. 使用SSD提升加载速度

### 安全配置
```json
{
  "bot": {
    "runs_count": 50,  // 每次只跑50局
    "delay_between_runs": 1.5
  },
  "sorceress": {
    "safety": {
      "teleport_away_after_cast": true,
      "drink_potion_after_kill": true,
      "wait_before_pickup": 2.0
    }
  }
}
```

---

## 🛠️ 辅助工具

### 1. 坐标获取
```bash
python coordinate_helper.py
```
实时显示鼠标坐标，按数字键保存。

### 2. 颜色校准
```bash
python calibrate_colors.py
```
点击物品文字获取准确的BGR颜色值。

### 3. 物品检测测试
```bash
python test_item_detection.py
```
测试物品检测功能，生成标记图像。

---

## 📝 更新日志

### v1.0.0 (2024)
- ✅ 完整的自动化流程
- ✅ 智能物品检测和过滤
- ✅ 安全机制（防尸爆）
- ✅ 随机化功能（防检测）
- ✅ 游戏名称轮换
- ✅ 防卡住导航系统
- ✅ 统计报告系统

---

## ⚠️ 免责声明

1. 本程序仅供学习和研究使用
2. 使用自动化程序可能违反游戏服务条款
3. 存在账号封禁风险，请谨慎使用
4. 建议仅在单机模式或私服使用
5. 作者不对任何后果负责

---

## 📄 许可证

MIT License

---

**祝你刷出好装备！** 🎮💎✨
